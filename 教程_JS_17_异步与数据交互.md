# JavaScript 第 17 步：异步与数据交互

配套演示：HTMLlearning/17_js_async_data.html

## 目标
- 理解 Promise 基本用法与状态（pending/fulfilled/rejected）。
- 熟练使用 async/await、try/catch 进行异步控制与错误处理。
- 学会并发请求（Promise.all）与结果合并。
- 知道如何提示加载/错误/成功状态，避免“静默失败”。
- 简单实现失败重试的逻辑。

---

## 1. Promise 与 async/await
- Promise 是对未来值的描述：`new Promise((resolve, reject) => { ... })`。
- async/await 让异步代码更像同步；记得用 try/catch 捕获错误。
- 典型模式：
  ```js
  async function load() {
    try {
      const data = await fetch(url).then(r => r.json());
    } catch (err) {
      console.error(err);
    }
  }
  ```

## 2. 并发请求（Promise.all）
- 同时请求多个数据源，所有成功才进入 then / await 返回。
- 如果任意一个失败，会直接抛出，需要 try/catch。
  ```js
  const [user, stats] = await Promise.all([fetchUser(), fetchStats()]);
  ```

## 3. 错误处理与用户反馈
- Loading：展示“加载中…”避免空白屏。
- Error：展示错误信息，不要吞掉；可提供重试按钮。
- Success：展示结果，或更新列表。

## 4. 简单重试策略
- 设定最大重试次数（如 1-2 次）。
- 循环尝试，失败后再试，超过次数则提示失败。

## 5. 小实践要点
- 不要在未信任的输入上使用 innerHTML（本示例为自有数据演示）。
- 并发示例可用 Promise.all；需要“一个成功即可”时用 Promise.any（了解）。
- 当有依赖顺序的请求时用 await 顺序执行。

---

## 实践任务
1) 将 fakeFetch 替换为实际接口或本地 JSON，展示加载/错误/成功状态。
2) 扩展并发示例：再加一个配置请求，合并并显示所有字段。
3) 给重试逻辑增加最大次数提示（如“已重试 2/2 次”）。
4) 为列表添加“刷新”按钮，点击重新加载并闪烁 loading 状态。

---

## 小提示
- async 函数默认返回 Promise；抛出的错误会变为 rejected 状态。
- 请求前后统一设置 loading 与 error 变量，方便 UI 绑定。
- 需要限流时，用队列或信号量控制并发；需要超时时间时可以用 Promise.race 包装。
