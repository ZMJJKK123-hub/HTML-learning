# JavaScript 第 18 步：组件化与状态

配套演示：HTMLlearning/18_js_components_state.html

## 目标
- 用“状态对象 + 渲染函数”管理 UI，避免零散 DOM 改动。
- 练习可复用组件模式：Tabs（委托 + ARIA）、Modal（焦点管理）、Toast（全局队列）。
- 理解局部状态与全局状态的区分，确保入口/出口清晰。
- 兼顾可访问性：ARIA 属性、焦点恢复、Esc 关闭、直播区域提示。

---

## 1. 状态管理基本形态
- 局部状态：组件内部的当前选项、是否展开。
- 全局状态：跨区域共享的数据（如 toast 队列）。
- 模式：state 对象 + render 函数；所有变更通过 render 同步到 DOM。

## 2. Tabs 组件（委托 + ARIA）
- 事件委托：tabList 监听 click，判定 target。
- 状态：当前选中的 tab key。
- ARIA：`role="tablist"`、`role="tab"`、`aria-selected`。
- 切换时同步面板显示/隐藏。

## 3. Modal 组件（焦点管理）
- 打开前记住 lastFocus，关闭后恢复。
- 打开时设置 `aria-modal="true"`、`aria-hidden="false"`，并聚焦主按钮。
- Esc 关闭，点击遮罩关闭。
- 通过类名控制显示，避免频繁 set style。

## 4. Toast 队列（全局状态）
- 统一 `toastState` 数组存消息；push 后渲染，超时移除。
- 使用 aria-live + aria-atomic 提示屏幕阅读器。
- 渲染列表可作为“当前全局状态”可视化。

## 5. 练习任务
1) 给 Tabs 增加键盘导航（左右切换、Enter/Space 激活）。
2) 为 Modal 添加“确认前校验”分支：点击保存前先模拟校验，失败则提示 toast error。
3) Toast 增加类型 info/warn，不同颜色；并支持“清空全部”按钮。
4) 把 toastState 抽出到单独模块（js/state/toast.js），主模块导入使用。

---

## 小提示
- 统一通过 render 更新 DOM，避免同一状态在多处直接改动。
- 组件事件尽量委托在容器上，便于复用与动态节点。
- 可访问性习惯：aria-*、焦点圈、Esc 退出、aria-live 提示。
- 若组件增多，可按目录拆分 modules（如 components/tabs.js, modal.js, toast.js）。
